<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>KAÇ - Mobil Sürüm</title>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.9.0/lib/p5.min.js"></script>
  </head>
  <body>
    <script>
      let player;
      let playerImg;
      let obstacles = [];
      let score = 0;
      let gameOver = false;

      function preload() {
        // Yeni görselin adı burada!
        playerImg = loadImage("escappe-2.png");
      }

      function setup() {
        createCanvas(windowWidth, windowHeight);
        player = new Player();
      }

      function draw() {
        background(10, 10, 30);

        if (!gameOver) {
          player.update();
          player.show();

          // Engellerin oluşturulması
          if (frameCount % 70 === 0) {
            obstacles.push(new Obstacle());
          }

          for (let i = obstacles.length - 1; i >= 0; i--) {
            obstacles[i].update();
            obstacles[i].show();

            if (obstacles[i].hits(player)) {
              gameOver = true;
            }

            if (obstacles[i].offscreen()) {
              obstacles.splice(i, 1);
              score++;
            }
          }

          fill(255);
          textSize(24);
          text("Skor: " + score, 20, 40);
        } else {
          fill(255, 0, 0);
          textSize(48);
          textAlign(CENTER);
          text("OYUN BİTTİ", width / 2, height / 2);
          textSize(24);
          text("Yeniden başlamak için dokun veya tuşa bas", width / 2, height / 2 + 50);
        }
      }

      function touchStarted() {
        if (gameOver) {
          resetGame();
        } else {
          player.up();
        }
        return false;
      }

      function keyPressed() {
        if (key === ' ' || keyCode === UP_ARROW) {
          if (gameOver) {
            resetGame();
          } else {
            player.up();
          }
        }
      }

      function resetGame() {
        obstacles = [];
        score = 0;
        gameOver = false;
        player = new Player();
      }

      class Player {
        constructor() {
          this.x = 100;
          this.y = height / 2;
          this.size = 80;
          this.gravity = 0.7;
          this.lift = -12;
          this.velocity = 0;
        }

        up() {
          this.velocity += this.lift;
        }

        update() {
          this.velocity += this.gravity;
          this.y += this.velocity;
          this.velocity *= 0.9;

          if (this.y > height - this.size / 2) {
            this.y = height - this.size / 2;
            this.velocity = 0;
          }

          if (this.y < this.size / 2) {
            this.y = this.size / 2;
            this.velocity = 0;
          }
        }

        show() {
          imageMode(CENTER);
          image(playerImg, this.x, this.y, this.size, this.size);
        }
      }

      class Obstacle {
        constructor() {
          this.top = random(height / 2);
          this.bottom = random(height / 2);
          this.x = width;
          this.w = 60;
          this.speed = 6;
        }

        update() {
          this.x -= this.speed;
        }

        show() {
          fill(200, 50, 50);
          rect(this.x, 0, this.w, this.top);
          rect(this.x, height - this.bottom, this.w, this.bottom);
        }

        offscreen() {
          return this.x < -this.w;
        }

        hits(player) {
          if (
            player.y - player.size / 2 < this.top ||
            player.y + player.size / 2 > height - this.bottom
          ) {
            if (player.x + player.size / 2 > this.x && player.x - player.size / 2 < this.x + this.w) {
              return true;
            }
          }
          return false;
        }
      }
    </script>
  </body>
</html>
